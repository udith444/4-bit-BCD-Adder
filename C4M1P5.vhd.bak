library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.STD_LOGIC_UNSIGNED.ALL;  -- For '+' and comparison

entity C4M1P5 is
    Port (
        SW   : in  STD_LOGIC_VECTOR(8 downto 0);  -- Inputs
        HEX5 : out STD_LOGIC_VECTOR(6 downto 0);  -- Display A
        HEX3 : out STD_LOGIC_VECTOR(6 downto 0);  -- Display B
        HEX1 : out STD_LOGIC_VECTOR(6 downto 0);  -- Display S1
        HEX0 : out STD_LOGIC_VECTOR(6 downto 0)   -- Display S0
    );
end C4M1P5;

architecture Behavioral of C4M1P5 is

    signal A, B, S0 : STD_LOGIC_VECTOR(3 downto 0);
    signal c0       : STD_LOGIC;
    signal T0       : STD_LOGIC_VECTOR(4 downto 0);
    signal Z0       : STD_LOGIC_VECTOR(4 downto 0);
    signal c1       : STD_LOGIC;
    signal S1       : STD_LOGIC_VECTOR(3 downto 0);

begin

    -- Assign inputs
    A  <= SW(7 downto 4);
    B  <= SW(3 downto 0);
    c0 <= SW(8);

    -- Step 1: Add A + B + c0
    T0 <= ('0' & A) + ('0' & B) + ("0000" & c0);

    -- Step 2-8: Check if T0 > 9 and correct
    process (T0)
    begin
        if T0 > "01001" then  -- 9 in binary
            Z0 <= "01010";   -- 10 in binary
            c1 <= '1';
        else
            Z0 <= "00000";
            c1 <= '0';
        end if;
    end process;

    -- Step 9-10: Compute S0 and S1
    S0 <= (T0 - Z0)(3 downto 0);
    S1 <= "000" & c1;

    -- HEX Display for A (HEX5)
    HEX5 <= "1000000" when A = "0000" else
            "1111001" when A = "0001" else
            "0100100" when A = "0010" else
            "0110000" when A = "0011" else
            "0011001" when A = "0100" else
            "0010010" when A = "0101" else
            "0000010" when A = "0110" else
            "1111000" when A = "0111" else
            "0000000" when A = "1000" else
            "0010000" when A = "1001" else
            "1111111";

    -- HEX Display for B (HEX3)
    HEX3 <= "1000000" when B = "0000" else
            "1111001" when B = "0001" else
            "0100100" when B = "0010" else
            "0110000" when B = "0011" else
            "0011001" when B = "0100" else
            "0010010" when B = "0101" else
            "0000010" when B = "0110" else
            "1111000" when B = "0111" else
            "0000000" when B = "1000" else
            "0010000" when B = "1001" else
            "1111111";

    -- HEX Display for S1 (HEX1)
    HEX1 <= "1000000" when S1 = "0000" else
            "1111001" when S1 = "0001" else
            "1111111";

    -- HEX Display for S0 (HEX0)
    HEX0 <= "1000000" when S0 = "0000" else
            "1111001" when S0 = "0001" else
            "0100100" when S0 = "0010" else
            "0110000" when S0 = "0011" else
            "0011001" when S0 = "0100" else
            "0010010" when S0 = "0101" else
            "0000010" when S0 = "0110" else
            "1111000" when S0 = "0111" else
            "0000000" when S0 = "1000" else
            "0010000" when S0 = "1001" else
            "1111111";

end Behavioral;
